====================
Support for XInclude
====================

XInclude is a generic and powerful XML dialect designed to include
entire documents or fragments into a main XML document.

PREPARATIONS
>>> import os
>>> from lxml import usedoctest
>>> from Products.CPSDesignerThemes.tests.test_engine import get_engine
>>> from Products.CPSDesignerThemes.interfaces import IThemeEngine

In the context of this test, we should have a predefined engine class
(PageEngine). Let's demonstrate that:
>>> IThemeEngine.implementedBy(PageEngine)
True

>>> engine = get_engine(PageEngine, 'xinclude', page='master.html')

Inclusions are processed before the cps specific directives. In our
case, a portlet can be merged exactly as for the
``theme1/simple_slot.html``  page
>>> PORTLET = ('Portlet One', '<ul id="portlet1"><li>foo</li></ul>')
>>> slot_name, slot = engine.extractSlotElements().next()
>>> frame_parent, frame = engine.extractSlotFrame(slot)
>>> engine.mergePortlets(frame_parent, frame, [PORTLET])
>>> print engine.dumpElement(slot)
<div xmlns="http://www.w3.org/1999/xhtml">
 <p>
  <span>Portlet One</span>
  <div>
   <ul id="portlet1">
     <li>foo</li>
   </ul>
  </div>
 </p>
</div>


